# API Документация - Giftly Service

## Общая информация

API для покупки подарков и звезд в Telegram. Все запросы требуют аутентификации через токен.

## Базовый URL
```
POST /giftly
```


## 1. Покупка подарка (buyGift)

### Endpoint
```
POST api/v1/giftly/buyGift
```

### Описание
Добавляет запрос на покупку подарка в очередь для асинхронной обработки.

### Параметры запроса (Body)

| Поле | Тип | Обязательное | Описание |
|------|-----|--------------|----------|
| `recipient` | string | ✅ | Username получателя подарка (без @) |
| `gift_id` | string | ✅ | ID подарка для покупки |
| `token` | string | ✅ | Токен аутентификации |
| `text` | string | ❌ | Текст сообщения с подарком (опционально) |

### Пример запроса
```json
{
  "recipient": "username",
  "gift_id": "gift_123",
  "token": "your_auth_token",
  "text": "Поздравляю!"
}
```

### Успешный ответ
```json
{
  "success": true,
  "message": "Подарок успешно добавлен в очередь",
  "id": "queue_id_123"
}
```

### Возможные ошибки

#### 400 Bad Request
- **Неверный токен**: `"Неверный токен, пожалуйста, обновите токен"`
- **Недостаточно средств**: `"Недостаточно денег на балансе админа для покупки подарка. Баланс: X.XX, цена подарка: Y.YY"`
- **Username не существует**: `"Username пользователя не занят"`
- **Платные сообщения**: `"У пользователя включены платные сообщения, должен написать первым"`
- **Пользователь не писал**: `"Пользователь не написал, чтобы получить подарок"`

#### 401 Unauthorized
- **Отсутствует токен**: `"Token is required"`

---

## 2. Покупка звезд (buyStars)

### Endpoint
```
POST api/v1/giftly/buyStars
```

### Описание
Покупает указанное количество звезд для указанного пользователя.

### Параметры запроса (Body)

| Поле | Тип | Обязательное | Описание |
|------|-----|--------------|----------|
| `stars` | number | ✅ | Количество звезд для покупки (минимум 50) |
| `token` | string | ✅ | Токен аутентификации |
| `username` | string | ✅ | Username пользователя для покупки звезд |

### Пример запроса
```json
{
  "stars": 100,
  "token": "your_auth_token",
  "username": "username"
}
```

### Успешный ответ
```json
{
  "success": true,
  "message": "Покупка звезд успешно выполнена",
  "data": {
    "amountRub": 100.50,
    "amountTon": 0.5,
    "stars": 100,
    "username": "username",
    "recipient": "recipient_address",
    "finalText": "final_text"
  }
}
```

### Возможные ошибки

#### 400 Bad Request
- **Неверный токен**: `"Неверный токен, пожалуйста, обновите токен"`
- **Недостаточно средств**: `"Недостаточно денег на балансе админа для покупки звезд. Баланс: X.XX, цена звезд: Y.YY"`
- **Ошибка покупки**: `"Ошибка при покупке звезд"`

#### 401 Unauthorized
- **Отсутствует токен**: `"Token is required"`

---

## Коды состояния HTTP

| Код | Описание |
|-----|----------|
| 200 | Успешный запрос |
| 400 | Ошибка в запросе (Bad Request) |
| 401 | Не авторизован (Unauthorized) |
| 500 | Внутренняя ошибка сервера |

---

## Важные замечания

### Для buyGift:
- Запрос добавляется в очередь и обрабатывается асинхронно
- Обработка может занять до 1 часа
- Подарки в очереди более 24 часов автоматически удаляются
- Подарки в очереди более 1 часа обрабатываются реже

### Для buyStars:
- Минимальное количество звезд: 50
- Минимаьная комиссия 3% (операционные расходы сервиса)
- Покупка выполняется синхронно

### Общие требования:
- Все токены должны быть валидными и активными
- Баланс токена должен быть достаточным для выполнения операции
- Username получателя должен существовать и быть активным
